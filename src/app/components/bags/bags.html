<main>
  <app-navbar class="fixed top-0 left-0 z-50 w-full bg-white shadow-md"></app-navbar>
  <div class="w-full flex flex-wrap justify-around py-5 gap-10 mt-20">
    <div
      *ngFor="let bag of AllData"
      class="relative w-[450px] sm:w-[500px] h-[300px] px-3 py-2 flex justify-between border border-[#c0c0c0] hover:border-black rounded-[20px] shadow-lg"
    >
      
      <img [src]="bag.img_src" class="sm:h-70 sm:w-60 h-50 w-40 rounded-[20px]" alt="" />
      <div class="w-full px-5 py-3 flex flex-col gap-2">
        <h1 class="font-semibold">{{ bag.brand_name }}</h1>
        <p class="text-[#4a4747]">{{ bag.details }}</p>
        <div class="flex justify-start gap-6">
          <div
            class="flex justify-between border border-[#b4b4b4] bg-[#def9ff] sm:w-[100px] px-2 py-1 rounded-[10px]"
          >
            <button>Size: {{ bag.size }}</button>
            <app-down-arrow
              class="cursor-pointer"
              (click)="openPopup(bag._id, bag.qty, bag.size)"
            ></app-down-arrow>
          </div>
          <div
            class="flex justify-between border border-[#b4b4b4] bg-[#def9ff] sm:w-[100px] px-2 py-1 rounded-[10px]"
          >
            <button>Qty: {{ bag.qty }}</button>
            <app-down-arrow
              class="cursor-pointer"
              (click)="openPopup(bag._id,bag.qty, bag.size)"
            ></app-down-arrow>
          </div>
        </div>
        <div class="flex gap-3">
          <p class="font-semibold">₹{{ bag.new_rs }}</p>
          <p class="text-gray-500 line-through">₹{{ bag.old_rs }}</p>
          <p class="text-[#0c8f40]">{{ bag.offer }}% OFF</p>
        </div>
        <p class="text-[#0c8f40]">You Save ₹{{ bag.old_rs - bag.new_rs }}</p>
        <div class="flex gap-3 h-7">
          <app-truck></app-truck>
          <p class="text-[#4a4747]">
            Delivery by <span class="text-black">{{ bag.delivery }}</span>
          </p>
        </div>
        <div
          (click)="Remove(bag)"
          class="h-10 w-[150px] sm:w-[230px] mt-5 rounded-[10px] flex justify-between items-center px-2 border border-gray-500 cursor-pointer text-gray-500 hover:bg-red-500 hover:text-white hover:border-red-500"
        >
          <button class="cursor-pointer">Remove</button>
          <app-remove class=""></app-remove>
        </div>
      </div>
    </div>
  </div>
  <div #orderDetails class="flex flex-col py-5 pb-35">
    <p class="font-semibold text-[25px] pl-15">Order Details</p>
    <table class="">
      <tbody>
        <tr class="text-end">
          <td class="text-start pl-15 py-1">Bag Total</td>
          <td class="text-end pr-15">₹{{ bagTotal }}</td>
        </tr>
        <tr class="text-end">
          <td class="text-start pl-15 py-1">Bag Savings</td>
          <td class="text-end pr-15 text-[#0c8f40]">-₹{{ saveTotal - bagTotal }}.00</td>
        </tr>
        <tr class="text-end">
          <td class="text-start pl-15 py-1">Platform Fee</td>
          <td class="text-end pr-15">₹69.00</td>
        </tr>
        <tr class="text-end">
          <td class="text-start pl-15 py-1">Delivery Fee</td>
          <td class="text-end pr-15">
            <p class="text-[#0c8f40]">
              Free <span class="pl-2 line-through text-gray-600">₹99.00</span>
            </p>
          </td>
        </tr>
        <tr class="text-end">
          <td class="text-start pl-15 py-1">Coupon Savings</td>
          <td class="text-end pr-15 text-[#1712b8]">Apply Coupon</td>
        </tr>
        <!-- <tr class="text-end border-t border-[#b4b4b4]">
        <td class="text-start pl-15 text-[20px] font-semibold py-5">Amount Payable</td>
        <td class="text-end pr-15 text-[20px] font-semibold">₹1,169.00</td>
      </tr> -->
      </tbody>
    </table>
    <table class="mt-5">
      <tbody>
        <tr class="text-end border-t border-[#b4b4b4]">
          <td class="text-start pl-15 text-[23px] font-semibold py-5">Amount Payable</td>
          <td class="text-end pr-15 text-[23px] font-semibold">₹{{ bagTotal }}.00</td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- <div class="w-full border border-[#a0a0a0] fixed bottom-0 flex flex-col"> -->
  <div class="w-full border-t border-[#a0a0a0] fixed bottom-0 left-0 bg-white flex flex-col z-50">
    <p class="bg-[#7cfff4] text-center py-2">
      Cheers! <span class="font-semibold">You Saved ₹{{ saveTotal - bagTotal }}.00</span>
    </p>
    <div class="flex justify-around items-center py-4">
      <div class="flex flex-col justify-center items-center">
        <p class="text-[23px] font-semibold">₹{{ bagTotal }}.00</p>
        <p class="text-[#0d31f8] font-semibold cursor-pointer" (click)="scrollToOrderDetails()">
          View details
        </p>
      </div>

      <button class="text-[16px] px-5 py-3 bg-black text-white rounded-[10px] cursor-pointer">
        Proceed to Payment
      </button>
    </div>
  </div>

  <div
    *ngIf="showPopup"
    class="fixed inset-0 bg-[rgba(0,0,0,0.78)] flex justify-center items-center z-50"
    (click)="closePopup()"
  >
    <!-- POPUP BOX -->
    <div
      class="bg-white w-[400px] rounded-[20px] p-6 flex flex-col gap-6"
      (click)="$event.stopPropagation()"
    >
      <!-- Select Size -->
      <div class="flex flex-col gap-3">
        <p class="text-[20px] font-semibold">Select Size</p>
        <div class="flex gap-4 justify-start">
          <p
            *ngFor="let s of sizes"
            (click)="ChangeSize(s)"
            [ngClass]="s === size ? 'bg-black text-white' : 'bg-white text-black'"
            class="w-[50px] h-[50px] cursor-pointer text-center flex items-center justify-center rounded-[9px] shadow-md shadow-[#5b5b5b]"
          >
            {{ s }}
          </p>
        </div>
      </div>

      <!-- Select Quantity -->
      <div class="flex flex-col gap-3">
        <p class="text-[20px] font-semibold">Select Quantity</p>
        <div class="flex gap-4 justify-start">
          <p
            (click)="Decre()"
            class="w-[50px] h-[50px] text-center text-[24px] flex items-center justify-center rounded-[9px] shadow-md shadow-[#5b5b5b] cursor-pointer active:bg-gray-400"
          >
            -
          </p>
          <p
            class="w-[50px] h-[50px] text-center flex items-center justify-center rounded-[9px] shadow-md shadow-[#5b5b5b] bg-black text-white"
          >
            {{ qty }}
          </p>
          <p
            (click)="Incre()"
            class="w-[50px] h-[50px] text-center text-[24px] flex items-center justify-center rounded-[9px] shadow-md shadow-[#5b5b5b] cursor-pointer active:bg-gray-400"
          >
            +
          </p>
        </div>
      </div>

      <!-- Apply Button -->
      <button
        class="bg-black text-white py-3 rounded-[10px] w-full cursor-pointer"
        (click)="Update(size)"
        (click)="closePopup()"
      >
        Apply
      </button>
    </div>
  </div>
</main>
